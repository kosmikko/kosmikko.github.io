<!DOCTYPE html><html lang="en"><head><!-- Meta--><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>Rewindy tech stack | mikkolehtinen.com</title><meta name="description" content="When your website appears in search results in say Google, the text here will be shown underneath your website's title."><meta name="keywords" content="place, your, website, keywoards, here, keep, them, related, to, the, content, of, your, website"><meta name="author" content="Mikko Lehtinen"><meta http-equiv="X-Powered-By" content="DocPad"/><meta name="viewport" content="width=device-width"><!-- Icons--><link rel="shortcut icon" href="img/favicon.png"><!--[if lt IE 9]><script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- Styles--><link rel="stylesheet" href="/styles/monokai.css" /><link rel="stylesheet" href="/styles/main.css" /><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" type="text/css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" type="text/css"><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', "UA-18743700-1"]);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body><header class="logo"><hgroup><h1><a href="/">mikkolehtinen.com</a></h1></hgroup></header><article id="maincolumn"><section id="content" class="content"><article class="post"><header><h1><a href="/blog/2012/05/25/rewindy-tech-stack/">Rewindy tech stack</a></h1><p class="meta">May 25 2012</p></header><div class="page-content"><p>I haven&#39;t seen too many <a href="http://blog.fogcreek.com/the-trello-tech-stack/">good</a> blog posts on how to build architecture for a modern, frontend-heavy HTML5 app, so I thought I&#39;d try to explain our stack while choices are still fresh in memory. We are just <a href="http://www.rewindy.com">getting started</a> (just started private alpha) so things will still change and evolve.

</p>
<p>Don&#39;t reinvent the wheel. I believe that especially in an early-stage startup the best code is the code you don&#39;t need to write yourself(SaaS) and best way to host your server is let someone do that for you (PaaS). When choosing components for <a href="http://www.rewindy.com">Rewindy</a>, we opted for choices that got us moving as fast as possible. Performance and scalability are good to keep on mind but there&#39;s time for optimizing later, if the app succeeds.

</p>
<p>Plan was to use a third party service or existing component whenever possible instead of building our own, even though sometimes that means making few compromises. That allows us to maximize the development on our core business.  Surely later it makes sense to start replacing suboptimal parts in the system with custom code or servers, if that is needed for cost or performance reasons. Still it&#39;s good to keep in mind that often you don&#39;t need library or framework for that feature, a few lines of code will do just fine. Choose the best tools for the job.
<!-- more -->

</p>
<h1>Backend</h1>
<p>I prefer expressive and quick to write languages that allow us to have as little code as possible. In the backend we have pretty much just a rest API, so we could&#39;ve chosen any language. Python was our choice, since it&#39;s a great versatile language for the web and it&#39;s one of the most readable languages when used properly.

</p>
<p>Really, <a href="http://www.codinghorror.com/blog/2008/05/php-sucks-but-it-doesnt-matter.html">it doesn&#39;t really matter</a> you can write your backend using <a href="http://en.wikipedia.org/wiki/Brainfuck">Brainfuck</a> or <a href="http://me.veekun.com/blog/2012/04/09/php-a-fractal-of-bad-design/">PHP</a>, but I believe it&#39;s crucial to enjoy the language and keep the focus in writing the relevant stuff. With Python it&#39;s easy to keep your code simple and maintainable.

</p>
<p>In Finland most companies, even startups still tend to favor PHP and Java, most likely since there&#39;s a lot of cheap developer power available. Still, finding good developers for any language is hard.

</p>
<h2>Hosting</h2>
<p>There&#39;s <a href="http://kencochrane.net/blog/2011/06/django-hosting-roundup-who-wins/">many</a> options for hosting Python apps. We picked Heroku since it&#39;s mature, well <a href="http://blog.heroku.com/archives/2010/12/8/the_next_level/">backed</a> and offers great set of tools for developers. Sure there&#39;s <a href="http://tech.blog.aknin.name/2012/03/09/heroku-is-great-however/">some things</a> that could be better, but overall it&#39;s a great choice.

</p>
<p>We are storing our files in Amazon S3, we also use S3 for serving our static assets (except for fonts, which we use Rackspace Cloud Files due to <a href="https://forums.aws.amazon.com/thread.jspa?threadID=34281">this issue</a>). We picked S3 mainly due to wide integration options and e.g. better CLI tools than Cloud Files. Hosting static assets outside Heroku is highly recommended and this setup has been working great.

</p>
<h2>MongoDB</h2>
<p>We decided to use document datastore mainly to get moving fast by moving complexity from application level to database. MongoDB is good general use document store, with great developer experience. MongoLab is currently our SaaS service, no issues so far but let&#39;s see how it works when we get more traffic. I&#39;m aware of the scaling issues there might be, but 10gen has been improving e.g. <a href="http://blog.serverdensity.com/2012/05/23/goodbye-global-lock-mongodb-2-0-vs-2-2/">locking issues</a> and things are getting better. Be sure to check the <a href="http://blog.engineering.kiip.me/post/20988881092/a-year-with-mongodb">critisism</a> and evaluate carefully whether Mongo is the best choice for your data and app.

</p>
<h4><a href="http://mongoengine.org/">MongoEngine</a></h4>
<p>MongoEngine is a Document-Object Mapper (like ORM, but for document databases) for working with MongoDB from Python. It&#39;s one of the most mature ones available for Python. It&#39;s actively developed and they just came out with 0.6.x with bunch of <a href="https://github.com/MongoEngine/mongoengine/blob/master/docs/changelog.rst">nice features</a>. Requires <a href="http://api.mongodb.org/python/current/">PyMongo</a>, which is just about to get <a href="http://api.mongodb.org/python/current/examples/gevent.html">Gevent</a> support. If you&#39;re looking for async support you might want to watch <a href="http://www.10gen.com/presentations/webinar/Asynchronous-MongoDB-with-Python-and-Tornado">this webinar</a>.


</p>
<h2><a href="http://flask.pocoo.org/">Flask</a></h2>
<p>This time, Django had to go. I wanted fast, quick to tweak framework, with just the minimal functionality and not a massive beast with heavy footprint and too much magic. Flask has a good selection of extensions to plug in the missing features and seems to be the most popular Python micro framework. Flask has been a pleasure, haven&#39;t a missed a thing yet from Django. Flask has great documentation (not as good as Django though), it&#39;s fast, clean and you can even read the full code without pulling your hair out.

</p>
<p>These are the most relevant extensions we use:
</p>
<h4><a href="http://packages.python.org/Flask-WTF/">Flask-wtf</a></h4>
<p>Offers helpers for <a href="http://wtforms.simplecodes.com/docs/dev/">WTForms</a> integration, CSRF protection, etc. We use WTForms for admin forms and validating AJAX posts.
</p>
<h4><a href="https://github.com/sbook/flask-mongoengine">Flask-mongoengine</a></h4>
<p>Provides integration to Flask and WTForms.
</p>
<h4><a href="http://packages.python.org/Flask-Babel/">Flask-Babel</a></h4>
<p>Adds i18n and l10n support to Flask.
</p>
<h4><a href="http://packages.python.org/Flask-Script/">Flask-Script</a></h4>
<p>Provides support for writing external scripts in Flask. Think manage.py in Django.
</p>
<h4><a href="http://packages.python.org/Flask-Login/">Flask-Login</a></h4>
<p>User session management. Our login solution is built on top of Flask-Login and <a href="http://pypi.python.org/pypi/passlib">passlib</a>

</p>
<h2>Redis &amp; RQ</h2>
<p><a href="http://python-rq.org/">RQ</a> is a Redis-based simple library for queuing tasks and processing them on background. It works great for our simple needs, and avoids the complexity of Celery and the likes. <a href="https://devcenter.heroku.com/articles/redistogo">Redis To Go</a> has a Heroku addon.

</p>
<h1>Frontend</h1>
<p>Most of our code is on the frontend, so it was very important to pick tools that allow us to scale and maintain quite large and complex JavaScript application.

</p>
<h2><a href="http://documentcloud.github.com/backbone/">Backbone.js</a></h2>
<p>Backbone.js has a good momentum and quite active community. There&#39;s already many common problems solved with Backbone, so you don&#39;t have to reinvent the wheel. It&#39;s the common ground for many frontend heavy projects. There&#39;s stellar documentation and plenty of examples available.

</p>
<p>Yet Backbone is very tiny and light weight, so you have to prepared to write a lot of basic code on top of it or use some of the helper frameworks mentioned below. If you&#39;re looking for more of a full stack framework, check <a href="http://addyosmani.github.com/todomvc/">Addy Osmani&#39;s TodoMVC comparison of popular MVC frameworks</a>.

</p>
<p>There&#39;s quite many developers with some level of knowledge for backbone which helps recruitment. Though a good JavaScript developer can pick up any framework and be productive in few days.

</p>
<h3><a href="https://github.com/chaplinjs/chaplin">Chaplin</a></h3>
<p>There&#39;s few good meta frameworks for backbone out there, check also <a href="http://walmartlabs.github.com/thorax/">Thorax</a>,  and <a href="http://derickbailey.github.com/backbone.marionette/">Backbone.Marionette</a> solving many common issues. We picked Chaplin, since it has good docs, cleanest code and it provided solutions to our needs and was based on same tools that we are using. Read the <a href="http://9elements.com/io/?p=680">introduction</a> if interested.

</p>
<p>Chaplin is the basis of our application, and it was quick to build our custom stuff on top of it. Recently it has been developed more towards real framework, but it&#39;s still undergoing pretty heavy refactoring so be prepared for sudden changes.

</p>
<h3><a href="https://github.com/derickbailey/backbone.modelbinding">Backbone.modelbinding</a></h3>
<p>This plugin provides a simple, convention based mechanism to create bi-directional binding between your HTML form input elements and your Backbone models

</p>
<h3><a href="https://github.com/thedersen/backbone.validation">Backbone.validation</a></h3>
<p>Reusable validation rules both to validate your model and to validate form input, as well as providing a simple way of notifying users about errors when they are populating forms. <a href="http://thedersen.com/2011/12/28/backbonevalidation/">Read more</a>

</p>
<h2><a href="http://coffeescript.org/">CoffeeScript</a></h2>
<p>With CoffeeScript, writing JavaScript becomes fun again.
Code is cleaner and less verbose, leading to faster development and less bugs.
Sure there&#39;s opinions <a href="http://ryanflorence.com/2011/case-against-coffeescript/">against it</a>, but seems that many have <a href="http://ryanflorence.com/2012/javascript-coffeescript-rewrite/">changed their opinion</a>?
Just saying that you should try it. I love it and I&#39;m not going back to vanilla JS. Debugging is not an issue when you use small files with require.js.
And plz don&#39;t make those uncomprehensible magic one-liners.

</p>
<ul>
<li><a href="http://arcturo.github.com/library/coffeescript/">The Little Book on CoffeeScript</a></li>
<li><a href="http://autotelicum.github.com/Smooth-CoffeeScript/interactive/interactive-coffeescript.html">Smooth CoffeeScript — Interactive Edition</a></li>
<li><a href="http://js2coffee.org/">Js2coffee: convert JavaScript code to CoffeeScript</a></li>
</ul>
<h2><a href="http://jquery.com/">jQuery</a></h2>
<p>We are using jQuery for DOM manip, animation, ajax, etc. basics. I would like to replace it with something more lightweight (e.g. Zepto/Ender), but that would need some work since for example Bootstrap depends on jQuery (though there seems to be unofficial <a href="https://github.com/rvagg/ender-bootstrap">Ender port</a> of Bootstrap).

</p>
<h2><a href="http://requirejs.org/">Require.js</a></h2>
<p>We use require.js for:

</p>
<ul>
<li>AMD script async loading and helps to organize code into files</li>
<li>RequireJS text add-on (to assist with external template management)</li>
<li>r.js for handling script optimization</li>
</ul>
<p>Require.js is flexible and versatile way to load files and modules, and I don&#39;t see the slightly verbose syntax as an issue. I haven&#39;t optimized module loading yet, so we are serving code in a single file. It would make sense to at least separate the code that rarely changes, so users don&#39;t have to reload all the code. There are other options for handling file loading and dependency management, check at least <a href="http://labjs.com/">LABjs</a>,<a href="https://github.com/LearnBoost/browserbuild">Browserbuild</a> and <a href="http://brunch.io/">Brunch</a>, which btw. has integrated with Chaplin recently.

</p>
<h2><a href="http://handlebarsjs.com/">Handlebars.js</a></h2>
<p>There&#39;s no shortage on client-side templating libraries. Handlebars was our choice, since it supports just enough features for our needs. Mustache style is quite readable, and handlebars supports pre-compilation. There&#39;s pretty ok documentation and some plugins available. We easily added helpers for e.g. <a href="http://rockycode.com/blog/i18n-strings-requirejs/">i18n</a> and date formatting with <a href="http://momentjs.com/">Moment.js</a>.

</p>
<h2>File upload</h2>
<p>Upload is one of the key parts of our system. Implementing a fast and scalable backend for handling concurrent uploads is not trivial, so we opted to start with 3rd party service for that. <a href="http://transloadit.com/">Transloadit</a> is <a href="http://debuggable.com/posts/parsing-file-uploads-at-500-mb-s-with-node-js:4c03862e-351c-4faa-bb67-4365cbdd56cb">based on</a> Node.js and formidable, they have great customer support and the pricing is ok for us, at least until our traffic increases significantly.

</p>
<p>Key thing for choosing Transloadit was that they allow storing our data in our own S3 buckets, so in case we want to change the service provider or implement our own solution, migration is a non-issue. Integration was a snap, and even though they&#39;ve had some hiccups in the service, thing seem to be improving all the time. Check also <a href="http://www.blitline.com/">Blitline</a> for an alternative SaaS solution.

</p>
<h2><a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a></h2>
<p>We decided to start with a full stack css framework, providing basic UI components and responsive grid. Twitter bootstrap provides all that, and more, so there&#39;s need to remove some unnecessary parts. The components are good quality and look ok out of the box, not quite as nice as <a href="http://foundation.zurb.com/">Zurb Foundation</a>, but JavaScript components are a bit more extensible better suited for dynamic apps. Cons for Bootstrap is its large size, dependency on jQuery, and it&#39;s quite hard to choose subset of css components. I&#39;d rather start from bare bones and add components as needed.

</p>
<h2><a href="http://learnboost.github.com/stylus/">Stylus</a></h2>
<p>I highly recommend using a CSS preprocessor for writing cleaner and more maintainable CSS. Still not sure if Stylus is currently the best choice. We considered SASS too and I have more experience with that. Stylus is perhaps slightly less verbose and open for different syntaxes. SASS on the other hand offers nice features such as media query bubbling, which would be great for responsive design. Check <a href="http://retype.posterous.com/switching-from-sass-to-stylus">this post</a> for more comprehensive review.

</p>
<h2>Code structure</h2>
<p>I&#39;m really not a fan of Rails convention of organizing files and folders. So instead of stashing all my views under a single &#39;views&#39;-folder, I put my files under a subfolder for module or functionality. See below for example. This really helps you finding your files and keeping your sanity when you have tens or hundreds of files. I keep my files short and simple, so just one thing per file.

</p>
<pre class="highlighted"><code class="avrasm">├── Makefile
├── README<span class="preprocessor">.md</span>
├── app
│   ├── application<span class="preprocessor">.coffee</span>                        Application bootstrapping
│   ├── assets
│   │   └── images
│   │   └── css
│   ├── chaplin                                   Chaplin <span class="preprocessor">.coffee</span> files
│   ├── initialize<span class="preprocessor">.coffee</span>                         Require<span class="preprocessor">.js</span> config
│   ├── login                                     This is an example application module <span class="keyword">in</span> our app
│   │   ├── controllers
│   │   │   └── login_controller<span class="preprocessor">.coffee</span>
│   │   ├── locale
│   │   │   └── en-GB<span class="preprocessor">.coffee</span>
│   │   ├── models
│   │   │   └── credentials<span class="preprocessor">.coffee</span>
│   │   ├── templates
│   │   │   ├── login_form<span class="preprocessor">.hbs</span>
│   │   │   └── login_modal<span class="preprocessor">.hbs</span>
│   │   └── views
│   │       ├── login_form<span class="preprocessor">.coffee</span>
│   │       └── login_modal<span class="preprocessor">.coffee</span>
├── app<span class="preprocessor">.build</span><span class="preprocessor">.js</span>                                  Require<span class="preprocessor">.js</span> build file
├── build                                         (Automatically) Compiled JS &amp; CSS files
├── prod-build                                    Production(minified) build
├── test                                          Tests <span class="preprocessor">.coffee</span> files
└── vendor
    ├── bootstrap                                 Twitter Bootstrap
    │   ├── img
    │   ├── js
    │   └── less
    └── js                                        Misc. <span class="number">3</span>rd part JS files</code></pre>
<h2>Build process</h2>
<p>There&#39;s two needs in our case, the build tool needs to compile <em>.coffee</em> and <em>.styl</em> files on the fly and concatenate and minify files for production. There <a href="http://blog.paracode.com/2012/02/15/build-mgmt-javascript-coffeescript/">lots of tools</a> for that, but we couldn&#39;t find any tool perfectly fitting our needs, so I wrote our custom script using Gnu Makefile. Little bit based on TJ Holowaychuck&#39;s <a href="https://github.com/visionmedia/uikit/blob/master/Makefile">Makefiles</a> and thx to Vli for the base version.

</p>
<p>That&#39;s very lo-fi but gets the job done quickly and it&#39;s easily extensible and modifiable. I&#39;ll try and share our Makefile later. Check also <a href="https://github.com/cowboy/grunt">Grunt</a>, which seems good and has nice plugins for many needs.


</p>
<h1>Testing</h1>
<h2>Jenkins</h2>
<p>De-facto standard for continuous integration servers. Travis looks good but it&#39;s not yet available for private repos. Jenkins runs our test suite and continuosly deploys to our staging server in Heroku. Production deployments are currently triggered manually using our deploy script.

</p>
<h2><a href="http://visionmedia.github.com/mocha/">Mocha</a></h2>
<p>Mocha is the basis of our front end unit testing framework. It&#39;s customisable enough to support both behaviour-driven and test-driven development styles, it has lots of test reporter format options which makes it easy to fit our CI and workflow. Only issue I&#39;ve had with it, is how to integrate it with require.js when running tests from both Node.js &amp; browser? Check this <a href="http://blog.james-carr.org/2012/01/16/blog-rolling-with-mongodb-node-js-and-coffeescript/">tutorial</a> on how Mocha works. Our test tools also include <a href="https://github.com/LearnBoost/expect.js">expect.js</a> and <a href="http://sinonjs.org/">Sinon.js</a>

</p>
<h2><a href="http://zombie.labnotes.org/">Zombie.js</a></h2>
<p>We haven&#39;t had too much time to write acceptance/full-stack tests yet, but so far Zombie.js seems ok for the job. Other options could be Phantom.js with Casper.js or some SaaS solution like SauceLabs.

</p>
<h2>Backend unit tests</h2>
<p>We are using basic <a href="http://docs.python.org/library/unittest.html">unittest</a> + <a href="http://packages.python.org/Flask-Testing/">Flask-testing</a> extension and running our tests with <a href="https://github.com/nose-devs/nose">nose</a>.

</p>
<h2>Updates</h2>
<p>Join in the discussion on <a href="http://news.ycombinator.com/item?id=4024923">Hacker News</a></p>
</div><p class="postmeta"><span>Posted by Mikko Lehtinen</span><date>May 25 2012</date><span class="tags">Backbone.js,Python,HTML5,JavaScript,CoffeeScript</span></p><div class="sharing"><a href="https://twitter.com/share" data-via="kosmikko" data-related="kosmikko" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></div></article></section></article><aside id="sidebar"><section id="recent-posts"><h2>Recent posts</h2><ul><li><a href="/blog/2013-01-31-jenkins-setup-for-a-javascript-project">Jenkins setup for a JavaScript project</a></li><li><a href="/blog/2013/01/13/new-mac-setup/">Setting up a new Mac</a></li><li><a href="/blog/2012/08/03/structuring-complex-backbone-dot-js-apps/">Structuring complex Backbone.js apps</a></li><li><a href="/blog/2012/07/10/using-gnu-make-as-frontend-build-tool/">Using GNU Make as a frontend build tool</a></li><li><a href="/blog/2012/06/30/extending-backbone-views-using-mixins/">Extending Backbone views using mixins</a></li><li><a href="/blog/2012/05/25/rewindy-tech-stack/">Rewindy tech stack</a></li><li><a href="/blog/2012-05-16-migrated-to-octopress">Migrated to Octopress</a></li><li><a href="/blog/2010-11-05-cross-browser-buttons-with-css3-and-sass">Cross-browser buttons with CSS3 and Sass</a></li><li><a href="/blog/2010-10-28-app-engine-helpers-for-zsh">App Engine helpers for ZSH</a></li><li><a href="/blog/2010-10-26-markup-enabled-notational-velocity">Markup-enabled Notational Velocity</a></li><li><a href="/blog/2010-10-15-programmers-keyboard-layout">Programmer's keyboard layout</a></li><li><a href="/blog/2010-10-01-improving-kindle3-experience">Improving Kindle3 experience</a></li><li><a href="/blog/2010-09-24-osx-zsh-magic">OSX ZSH magic</a></li><li><a href="/blog/2010-09-24-decorator-for-executing-a-function-in-a-given-namespace">Decorator for executing a function in a given namespace</a></li></ul></section><section id="tweets"><h2>Latest tweets</h2><li><datetime>Jan 29 2013</datetime><a href="https://twitter.com/#!/kosmikko/status/296254455345737728" title="View on Twitter">Full-Spectrum Testing with AngularJS and Testacular http://t.co/6Zr6w1aE</a></li><li><datetime>Jan 29 2013</datetime><a href="https://twitter.com/#!/kosmikko/status/296176247141195776" title="View on Twitter">gr8, sublime text 3 beta available for reg users http://t.co/a8iJpU3u</a></li><li><datetime>Jan 28 2013</datetime><a href="https://twitter.com/#!/kosmikko/status/295891774524755968" title="View on Twitter">Helium - A minimal &amp; responsive frontend framework based on Bootstrap &amp; Foundation https://t.co/IFURd0Tq</a></li><li><datetime>Jan 28 2013</datetime><a href="https://twitter.com/#!/kosmikko/status/295885167917158401" title="View on Twitter">kelly norton: On Layout &amp; Web Performance http://t.co/Aa4lqWj2 via @kellegous</a></li><li><datetime>Jan 25 2013</datetime><a href="https://twitter.com/#!/kosmikko/status/294709999668711424" title="View on Twitter">The future of agile development - Do the right things right and fast http://t.co/nqYA1yta</a></li></section></aside><!-- Scripts--></body></html>